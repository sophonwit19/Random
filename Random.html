<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>สุ่มกลุ่มทันที ใส่ชื่อทีละคน</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Poppins", sans-serif;
      background: #f0f4f8;
      margin: 0; padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 20px;
      color: #1a237e;
    }
    #inputSection {
      margin: 20px 0;
      max-width: 600px;
      width: 90%;
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    #nameInput, #genderSelect {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid #3949ab;
      outline: none;
    }
    #nameInput { width: 40%; }
    #genderSelect {
      width: 20%;
      background: white;
      color: #1a237e;
    }
    #spinBtn, #clearBtn {
      padding: 10px 20px;
      background: #3949ab;
      color: white;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.3s;
    }
    #spinBtn:disabled, #clearBtn:disabled {
      background: #bbb;
      cursor: not-allowed;
    }
    #spinBtn:hover:not(:disabled), #clearBtn:hover:not(:disabled) {
      background: #1a237e;
    }
    #groupNumberDisplay {
      margin: 30px 0 10px 0;
      font-size: 28px;
      font-weight: 600;
      color: white;
      width: 220px;
      height: 220px;
      border-radius: 50%;
      background: linear-gradient(135deg, #3949ab, #1a237e);
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      box-shadow: 0 0 30px #3949ab88;
      padding: 20px;
    }
    #result {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 20px;
      min-height: 28px;
      color: #1a237e;
      text-align: center;
      max-width: 600px;
    }
    #groupsContainer {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      max-width: 960px;
      margin-bottom: 40px;
    }
    .groupBox {
      background: white;
      border: 3px solid #3949ab;
      border-radius: 14px;
      width: 280px;
      margin: 10px;
      padding: 10px 15px;
      box-shadow: 0 3px 6px #3949ab44;
    }
    .groupBox h3 {
      text-align: center;
      margin-top: 0;
      color: #3949ab;
    }
    .membersList {
      list-style: none;
      padding-left: 0;
      min-height: 130px;
    }
    .membersList li {
      margin: 4px 0;
      padding: 6px 12px;
      border-radius: 12px;
      color: white;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
    }
    .membersList li.male { background: #42a5f5; }
    .membersList li.female { background: #ec407a; }
    .status {
      text-align: center;
      font-weight: 700;
      margin-top: 8px;
      font-size: 18px;
    }
    .full { color: #d32f2f; }
    .notfull { color: #388e3c; }
    .credit {
      position: fixed;
      bottom: 10px;
      right: 20px;
      font-size: 14px;
      color: #888;
    }
  </style>
</head>
<body>

<h1>สุ่มกลุ่มทันที ใส่ชื่อทีละคน </h1>

<div id="inputSection">
  <input type="text" id="nameInput" placeholder="กรอกชื่อเล่น" maxlength="20" />
  <select id="genderSelect">
    <option value="" disabled selected>เลือกเพศ</option>
    <option value="male">ชาย</option>
    <option value="female">หญิง</option>
  </select>
  <button id="spinBtn">สุ่มกลุ่ม</button>
  <button id="clearBtn">เคลียร์รายชื่อทั้งหมด</button>
</div>

<div id="groupNumberDisplay">-</div>
<div id="result"></div>
<div id="groupsContainer"></div>
<div class="credit">จากฮิวโก้คนเท่</div>

<script>
  const maxPerGroup = 5;
  const totalGroups = 6;
  const STORAGE_KEY = "groupsDataWithGender";
  const fishNames = [
    "ปลาบึก", "ปลากราย", "ปลานิล", "ปลาคัง", "ปลาจาระเม็ดน้ำจืด", "ปลาสวาย"
  ];

  const nameInput = document.getElementById("nameInput");
  const genderSelect = document.getElementById("genderSelect");
  const spinBtn = document.getElementById("spinBtn");
  const clearBtn = document.getElementById("clearBtn");
  const result = document.getElementById("result");
  const groupsContainer = document.getElementById("groupsContainer");
  const groupNumberDisplay = document.getElementById("groupNumberDisplay");

  let groups = JSON.parse(localStorage.getItem(STORAGE_KEY));
  if (!groups || !Array.isArray(groups) || groups.length !== totalGroups) {
    groups = Array.from({ length: totalGroups }, () => []);
  }

  function saveGroups() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(groups));
  }

  function renderGroups() {
    groupsContainer.innerHTML = "";
    groups.forEach((group, i) => {
      const box = document.createElement("div");
      box.className = "groupBox";

      const h3 = document.createElement("h3");
      h3.textContent = `กลุ่ม ${fishNames[i]}`;
      box.appendChild(h3);

      const ul = document.createElement("ul");
      ul.className = "membersList";

      group.forEach(member => {
        const li = document.createElement("li");
        li.textContent = member.name;
        li.classList.add(member.gender);

        const genderSpan = document.createElement("span");
        genderSpan.textContent = member.gender === "male" ? "ชาย" : "หญิง";
        li.appendChild(genderSpan);
        ul.appendChild(li);
      });

      box.appendChild(ul);

      const status = document.createElement("div");
      status.className = "status";
      const maleCount = group.filter(m => m.gender === "male").length;
      const femaleCount = group.filter(m => m.gender === "female").length;

      if (group.length >= maxPerGroup) {
        status.textContent = `เต็มแล้ว (${group.length}/${maxPerGroup}) ชาย ${maleCount} หญิง ${femaleCount}`;
        status.classList.add("full");
      } else {
        status.textContent = `มีสมาชิก ${group.length}/${maxPerGroup} คน (ชาย ${maleCount} หญิง ${femaleCount})`;
        status.classList.add("notfull");
      }

      box.appendChild(status);
      groupsContainer.appendChild(box);
    });
  }

  function getAvailableGroupsForGender(gender) {
    let candidates = [];
    let minCount = Infinity;

    groups.forEach((group, idx) => {
      if (group.length < maxPerGroup) {
        const count = group.filter(m => m.gender === gender).length;
        if (count < minCount) {
          minCount = count;
          candidates = [{ idx, count }];
        } else if (count === minCount) {
          candidates.push({ idx, count });
        }
      }
    });
    return candidates;
  }

  function checkFullGroups() {
    if (groups.every(g => g.length === maxPerGroup)) {
      spinBtn.disabled = true;
      result.textContent = "ทุกกลุ่มเต็มแล้ว!";
      groupNumberDisplay.textContent = "-";
    } else {
      spinBtn.disabled = false;
    }
  }

  spinBtn.addEventListener("click", () => {
    const name = nameInput.value.trim();
    const gender = genderSelect.value;
    if (!name) return alert("กรุณากรอกชื่อเล่นก่อน");
    if (!gender) return alert("กรุณาเลือกเพศก่อน");
    if (groups.some(g => g.some(m => m.name === name))) {
      alert("ชื่อนี้ถูกเพิ่มในกลุ่มแล้ว");
      nameInput.value = "";
      return;
    }

    const candidates = getAvailableGroupsForGender(gender);
    if (candidates.length === 0) {
      alert("ไม่มีที่ว่างสำหรับเพศนี้แล้ว");
      return;
    }

    spinBtn.disabled = true;
    result.textContent = "กำลังสุ่มกลุ่ม...";
    let count = 0;
    const interval = setInterval(() => {
      count++;
      groupNumberDisplay.textContent = fishNames[count % totalGroups];
    }, 100);

    setTimeout(() => {
      clearInterval(interval);
      const selectedGroup = candidates[Math.floor(Math.random() * candidates.length)].idx;
      groups[selectedGroup].push({ name, gender });
      saveGroups();
      renderGroups();

      groupNumberDisplay.textContent = fishNames[selectedGroup];
      result.textContent = `ชื่อ ${name} (เพศ ${gender === "male" ? "ชาย" : "หญิง"}) อยู่ในกลุ่ม ${fishNames[selectedGroup]}`;
      nameInput.value = "";
      genderSelect.value = "";
      nameInput.focus();
      checkFullGroups();
    }, 4000);
  });

  clearBtn.addEventListener("click", () => {
    if (confirm("ยืนยันการลบรายชื่อทั้งหมด?")) {
      groups = Array.from({ length: totalGroups }, () => []);
      saveGroups();
      renderGroups();
      result.textContent = "";
      groupNumberDisplay.textContent = "-";
      spinBtn.disabled = false;
    }
  });

  renderGroups();
  checkFullGroups();
</script>

</body>
</html>